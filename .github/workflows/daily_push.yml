name: A-share Intraday Advice

on:
  schedule:
    - cron: '50 1 * * 1-5'   # 09:50
    - cron: '20 3 * * 1-5'   # 11:20
    - cron: '5 7 * * 1-5'    # 15:05
  workflow_dispatch:

jobs:
  push:
    runs-on: ubuntu-latest
    env:
      TUSHARE_TOKEN:      ${{ secrets.TUSHARE_TOKEN }}
      JUHE_KEY:           ${{ secrets.JUHE_KEY }}
      QWEN_API_KEY:       ${{ secrets.QWEN_API_KEY }}
      SCKEY:              ${{ secrets.SCKEY }}
      TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TELEGRAM_CHAT_ID:   ${{ secrets.TELEGRAM_CHAT_ID }}

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: '3.11', cache: 'pip' }
      - run: pip install -r requirements.txt

      - run: python holdings_tracker.py
      - run: python news_pipeline.py          # 实时生成 briefing.md & news_all.csv
      - run: python daily_push_qwen.py        # 推提示 + briefing

      - name: 上传 log
        uses: actions/upload-artifact@v4
        with:
          name: logs-and-history-最新
          path: |
            pipeline.log
            errors.log
            news_all.csv
            keywords_used.txt

          retention-days: 30
