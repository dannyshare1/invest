name: Daily Briefing
on:
  schedule:
    - cron: '55 23 * * *'   # 每天 07:55 CST
  workflow_dispatch:        # 手动触发
jobs:
  run:
    runs-on: ubuntu-latest
    env:
      TUSHARE_TOKEN:       ${{ secrets.TUSHARE_TOKEN }}
      ALPHA_KEY:           ${{ secrets.ALPHA_KEY }}
      FINNHUB_KEY:         ${{ secrets.FINNHUB_KEY }}
      JUHE_KEY:            ${{ secrets.JUHE_KEY }}
      SCKEY:               ${{ secrets.SCKEY }}
      TELEGRAM_BOT_TOKEN:  ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TELEGRAM_CHAT_ID:    ${{ secrets.TELEGRAM_CHAT_ID }}
      QWEN_API_KEY:        ${{ secrets.QWEN_API_KEY }}   # ← daily_push_qwen.py 用
      HOLDINGS_JSON: |
        [{"symbol":"510880.SH","name":"中证红利ETF","weight":0.12},
         {"symbol":"AAPL","name":"Apple Inc","weight":0.1}]
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install httpx python-dateutil rich openai pyyaml requests
          
      - name: holdings_tracker
        run: python holdings_tracker.py
        
      # ① 生成并推送新闻摘要
      - name: News briefing
        run: python news_pipeline.py --days 1 --max 40

      # ② 生成并推送投资建议
      - name: Qwen portfolio advice
        run: python daily_push_qwen.py
